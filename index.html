<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprende Python Interactivo</title>
    <!-- Carga de Tailwind CSS para un dise帽o moderno y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de la fuente Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados para la tipograf铆a y el editor */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .code-editor {
            font-family: monospace;
            background-color: #1e1e1e; /* Fondo oscuro tipo IDE */
            color: #d4d4d4; /* Color de texto claro */
            padding: 1rem;
            border-radius: 0.5rem;
            resize: none;
            min-height: 200px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        /* Resaltar el tema actual en el sidebar */
        .nav-item.active {
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
        }
        /* Estilo para el texto de c贸digo en las explicaciones */
        code {
            background-color: #e0e7ff;
            color: #4f46e5;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Encabezado (Header) -->
    <header class="bg-white shadow-md p-4 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold text-indigo-600">Aprende Python Interactivo</h1>
            <span class="text-sm text-gray-500 hidden sm:block">Conceptos Esenciales para Principiantes</span>
        </div>
    </header>

    <!-- Contenedor Principal (Sidebar y Contenido) -->
    <div class="flex flex-1 max-w-7xl mx-auto w-full">

        <!-- Navegaci贸n (Sidebar) - Visible en escritorio, colapsable en m贸vil -->
        <nav id="sidebar" class="w-64 bg-white p-4 border-r border-gray-200 hidden md:block">
            <h2 class="text-lg font-semibold mb-4 text-gray-700">Unidades</h2>
            <ul id="unit-list">
                <!-- Los 铆tems de las unidades se inyectar谩n aqu铆 por JavaScript -->
            </ul>
        </nav>

        <!-- rea de Contenido Principal -->
        <main class="flex-1 p-6 md:p-8">
            <div id="content-area" class="bg-white p-6 rounded-lg shadow-xl">
                <!-- T铆tulo del Tema -->
                <h2 id="topic-title" class="text-3xl font-bold text-gray-800 mb-4 border-b pb-2"></h2>

                <!-- Explicaci贸n Te贸rica -->
                <section id="theory-section" class="mb-8 text-gray-600 leading-relaxed"></section>

                <!-- Escenario Din谩mico (Problema y Editor) -->
                <section id="scenario-section" class="bg-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500">
                    <h3 class="text-2xl font-semibold text-indigo-700 mb-4">Escenario de Pr谩ctica</h3>
                    <p id="task-description" class="mb-4 text-gray-700"></p>

                    <!-- Editor de C贸digo -->
                    <textarea id="code-editor" class="code-editor w-full border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500" placeholder="# Escribe tu c贸digo Python aqu铆..."></textarea>

                    <!-- Bot贸n de Ejecutar -->
                    <button id="run-button" onclick="runCode()" class="mt-4 px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                        Ejecutar / Verificar
                    </button>
                </section>

                <!-- rea de Resultados y Retroalimentaci贸n -->
                <div id="results-area" class="mt-6 p-4 rounded-lg hidden" role="alert">
                    <p id="feedback-message" class="font-medium"></p>
                    <button id="next-button" onclick="loadNextScenario()" class="hidden mt-4 px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                        Siguiente Unidad &rarr;
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Pie de P谩gina (Footer) -->
    <footer class="bg-gray-800 text-white p-4 mt-auto">
        <div class="max-w-7xl mx-auto text-center text-sm">
            &copy; 2024 Aprende Python Interactivo. Proyecto Educativo.
        </div>
    </footer>

    <script>
        // L贸gica JavaScript para los escenarios din谩micos
        
        let currentScenarioIndex = 0;
        
        // Nuevo: Array para rastrear qu茅 escenarios han sido completados
        // Inicializado con todos en false.
        let completionStatus; 

        // Definici贸n de los escenarios de aprendizaje
        const SCENARIOS = [
            {
                id: 0,
                title: "Introducci贸n a Python",
                explanation: `Python es uno de los lenguajes de programaci贸n m谩s populares del mundo. Es conocido por su sintaxis clara y legible, lo que lo hace perfecto para principiantes.

                <p class="mt-3">Se utiliza en campos como desarrollo web, ciencia de datos, inteligencia artificial y automatizaci贸n.</p>`,
                task: "No hay ejercicio en esta unidad. Presiona 'Siguiente Unidad' para comenzar.",
                validation: (code) => {
                    // La unidad de introducci贸n siempre se considera completada con el bot贸n "Siguiente Unidad"
                    return { success: true, feedback: "隆Bienvenido! Es hora de empezar a programar." };
                }
            },
            {
                id: 1,
                title: "Variables y Asignaci贸n",
                explanation: `Una variable es un nombre que se refiere a un valor en la memoria de la computadora. Es como una etiqueta que le pones a una caja para saber qu茅 contiene.

                <p class="mt-3">Para asignar un valor, usamos el signo igual: <code>nombre_variable = valor</code>.</p>`,
                task: "Crea una variable llamada **'puntuacion'** y as铆gnale el valor entero **95**.",
                validation: (code) => {
                    // Limpia el c贸digo para una validaci贸n simple (remueve espacios y min煤sculas)
                    const normalizedCode = code.replace(/\s/g, '').toLowerCase();

                    // Regex para verificar si existe 'puntuacion=95'
                    const regex = /puntuacion=95(?!.)/;

                    if (!regex.test(normalizedCode)) {
                        return { success: false, feedback: "Aseg煤rate de que la variable se llame exactamente 'puntuacion' y el valor sea el n煤mero '95'. Revisa la ortograf铆a." };
                    }
                    return { success: true, feedback: "隆Excelente! La variable 'puntuacion' ha sido declarada y asignada correctamente." };
                }
            },
            {
                id: 2,
                title: "Tipos de Datos: String e Impresi贸n",
                explanation: `Una 'string' (cadena de texto) es una secuencia de caracteres, y siempre se encierra entre comillas (simples o dobles).

                <p class="mt-3">La funci贸n <code>print()</code> se usa para mostrar texto o el valor de una variable en la consola. Puedes concatenar (unir) strings con el operador <code>+</code>.</p>`,
                task: "Declara una variable **'saludo'** con el valor 'Hola ' (con un espacio final) y otra **'nombre'** con tu nombre. Luego, imprime la concatenaci贸n de ambas variables.",
                validation: (code) => {
                    // Para simular la ejecuci贸n de Python, validaremos 3 partes:
                    // 1. Declaraci贸n de saludo
                    // 2. Declaraci贸n de nombre
                    // 3. Uso de print() con la concatenaci贸n

                    if (!/saludo\s*=\s*['"]Hola\s+['"]/.test(code) && !/saludo\s*=\s*['"]Hola\s*['"]/.test(code)) {
                        return { success: false, feedback: "Falta o es incorrecta la variable 'saludo'. Debe contener 'Hola ' (con o sin comillas simples/dobles)." };
                    }

                    if (!/nombre\s*=\s*['"].+['"]/.test(code)) {
                         return { success: false, feedback: "Falta o es incorrecta la variable 'nombre'. Aseg煤rate de que tenga un valor de string (ej. 'Mundo')." };
                    }

                    if (!/print\s*\(\s*saludo\s*\+\s*nombre\s*\)/.test(code)) {
                        return { success: false, feedback: "Aseg煤rate de usar la funci贸n 'print(saludo + nombre)' para concatenar e imprimir las variables." };
                    }

                    return { success: true, feedback: "隆Correcto! Has usado variables de tipo string y la funci贸n 'print' para concatenarlas." };
                }
            },
            {
                id: 3,
                title: "Estructuras de Control: Condicionales (if/else)",
                explanation: `Las estructuras condicionales (<code>if</code>, <code>elif</code>, <code>else</code>) permiten que el programa tome decisiones. El bloque de c贸digo bajo un 'if' solo se ejecuta si la condici贸n es verdadera (True).

                <p class="mt-3">隆Recuerda la indentaci贸n y los dos puntos (:)!</p>`,
                task: "Dado que ya existe la variable `numero = 15`. Escribe una estructura `if` que imprima **'El n煤mero es grande'** si `numero` es mayor que 10, y un `else` que imprima **'El n煤mero es peque帽o'** en caso contrario.",
                validation: (code) => {
                    // Simulaci贸n del entorno: inyectar la variable inicial
                    const fullCode = "numero = 15\n" + code;
                    const result = { success: false, feedback: "" };

                    // 1. Verificar la estructura del if/else
                    if (!/if\s+numero\s*>\s*10\s*:\s*print\s*\(['"]El n煤mero es grande['"]\)/s.test(code)) {
                        result.feedback = "El bloque 'if' es incorrecto o no imprime el mensaje exacto: 'El n煤mero es grande'.";
                        return result;
                    }

                    if (!/else\s*:\s*print\s*\(['"]El n煤mero es peque帽o['"]\)/s.test(code)) {
                        result.feedback = "El bloque 'else' es incorrecto o no imprime el mensaje exacto: 'El n煤mero es peque帽o'.";
                        return result;
                    }

                    // 2. Simulaci贸n de la l贸gica (ejecutar 'numero = 15')
                    // Dado que 15 > 10 es True, el resultado esperado es 'El n煤mero es grande'.
                    // Aqu铆, simplemente validamos la estructura, ya que la simulaci贸n real de la ejecuci贸n es compleja.
                    
                    return { success: true, feedback: "隆Fant谩stico! Has implementado el condicional 'if/else' correctamente. El programa habr铆a impreso 'El n煤mero es grande'." };
                }
            }
        ];

        /**
         * Funci贸n para actualizar el estado de bloqueo visual en el sidebar.
         * Muestra un candado () si la unidad anterior no ha sido completada.
         */
        function updateSidebarLockStatus() {
            SCENARIOS.forEach((scenario, index) => {
                const navItem = document.getElementById(`nav-item-${index}`);
                
                // La unidad 0 (Introducci贸n) siempre est谩 disponible.
                if (index > 0) {
                    const isPreviousCompleted = completionStatus[index - 1];
                    
                    if (isPreviousCompleted) {
                        // Desbloqueado: se puede hacer clic
                        navItem.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-red-100');
                        navItem.classList.add('hover:bg-indigo-100');
                        navItem.innerHTML = `${index}. ${scenario.title}`;
                    } else {
                        // Bloqueado: no se puede hacer clic, icono de candado
                        navItem.classList.add('opacity-50', 'cursor-not-allowed');
                        navItem.classList.remove('hover:bg-indigo-100');
                        navItem.innerHTML = `<span class="mr-1" title="Unidad Bloqueada">&#128274;</span> ${index}. ${scenario.title}`;
                    }
                }
            });
        }


        // Funci贸n para cargar el escenario actual
        function loadScenario(index) {
            // L贸gica de Bloqueo: Si el 铆ndice es mayor que 0 y el escenario anterior NO est谩 completado
            if (index > 0 && !completionStatus[index - 1]) {
                const resultsArea = document.getElementById('results-area');
                const feedbackMessage = document.getElementById('feedback-message');
                const lastCompletedIndex = completionStatus.lastIndexOf(true);
                const goToIndex = lastCompletedIndex === -1 ? 0 : lastCompletedIndex;

                // Muestra un mensaje de bloqueo
                resultsArea.classList.remove('hidden', 'bg-green-100', 'border-green-500', 'text-green-700');
                resultsArea.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
                feedbackMessage.textContent = "隆Unidad Bloqueada! Debes completar el escenario anterior para acceder a este tema.";
                document.getElementById('next-button').classList.add('hidden');

                // Si se intent贸 navegar directamente a una unidad bloqueada, volvemos a la 煤ltima completada.
                if (index !== currentScenarioIndex) {
                    loadScenario(goToIndex); 
                }
                return;
            }

            currentScenarioIndex = index;
            const scenario = SCENARIOS[index];

            // 1. Actualizar Navegaci贸n
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.getElementById(`nav-item-${index}`).classList.add('active');

            // 2. Actualizar Contenido
            document.getElementById('topic-title').textContent = scenario.title;
            document.getElementById('theory-section').innerHTML = scenario.explanation;
            
            // 3. Actualizar Escenario de Pr谩ctica
            const taskEl = document.getElementById('task-description');
            const editorEl = document.getElementById('code-editor');
            const runButton = document.getElementById('run-button');

            if (scenario.task) {
                taskEl.innerHTML = scenario.task;
                // Mantener el valor predeterminado si existe, sino limpiarlo
                editorEl.value = scenario.id === 3 ? "numero = 15\n# Escribe tu c贸digo aqu铆...\n" : "";
                editorEl.classList.remove('hidden');
                runButton.classList.remove('hidden');
            } else {
                // Escenario sin tarea (como la introducci贸n)
                taskEl.textContent = scenario.task || "No hay ejercicio en esta unidad.";
                editorEl.value = "";
                editorEl.classList.add('hidden');
                runButton.classList.add('hidden');
            }
            
            // 4. Limpiar Resultados
            const resultsArea = document.getElementById('results-area');
            const nextButton = document.getElementById('next-button');

            resultsArea.classList.add('hidden');
            nextButton.classList.add('hidden');

            // 5. Si la unidad ya fue completada, mostrar el bot贸n de siguiente
            if (completionStatus[index]) {
                resultsArea.classList.remove('hidden', 'bg-red-100', 'border-red-500', 'text-red-700');
                resultsArea.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                feedbackMessage.textContent = "隆Ya has completado este escenario! Puedes pasar al siguiente.";
                nextButton.classList.remove('hidden');
            }
        }

        // Funci贸n para manejar el bot贸n de Ejecutar/Verificar
        function runCode() {
            const code = document.getElementById('code-editor').value;
            const scenario = SCENARIOS[currentScenarioIndex];
            const resultsArea = document.getElementById('results-area');
            const feedbackMessage = document.getElementById('feedback-message');
            const nextButton = document.getElementById('next-button');

            // Validar el c贸digo usando la funci贸n espec铆fica del escenario
            const validationResult = scenario.validation(code);

            resultsArea.classList.remove('hidden');
            feedbackMessage.textContent = validationResult.feedback;
            nextButton.classList.add('hidden'); // Ocultar por defecto

            if (validationResult.success) {
                // xito
                resultsArea.classList.remove('bg-red-100', 'border-red-500', 'text-red-700');
                resultsArea.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                
                // Nuevo: Marcar el escenario como completado y actualizar la interfaz
                completionStatus[currentScenarioIndex] = true;
                updateSidebarLockStatus();

                // Mostrar bot贸n para avanzar
                if (currentScenarioIndex < SCENARIOS.length - 1) {
                    nextButton.classList.remove('hidden');
                } else {
                    feedbackMessage.textContent += " 隆Has completado todas las unidades iniciales!";
                }

            } else {
                // Error
                resultsArea.classList.remove('bg-green-100', 'border-green-500', 'text-green-700');
                resultsArea.classList.add('bg-red-100', 'border-red-500', 'text-red-700');
            }
        }

        // Funci贸n para avanzar al siguiente escenario
        function loadNextScenario() {
            const nextIndex = currentScenarioIndex + 1;
            if (nextIndex < SCENARIOS.length) {
                // Ya se valid贸 en runCode que la unidad actual est茅 completa.
                loadScenario(nextIndex);
            } else {
                // Fin de los escenarios
                // En lugar de alert, usamos el 谩rea de resultados
                const resultsArea = document.getElementById('results-area');
                const feedbackMessage = document.getElementById('feedback-message');
                
                resultsArea.classList.remove('hidden', 'bg-red-100', 'border-red-500', 'text-red-700');
                resultsArea.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                feedbackMessage.textContent = "隆Felicidades! Has completado todos los escenarios iniciales.";
                document.getElementById('next-button').classList.add('hidden');

                // Opcional: Podr铆as volver a la introducci贸n o mantener el estado.
                // loadScenario(0); 
            }
        }

        // Funci贸n de inicializaci贸n
        function initApp() {
            const unitList = document.getElementById('unit-list');
            
            // Inicializar el estado de completado
            completionStatus = new Array(SCENARIOS.length).fill(false);
            
            // El primer escenario (Introducci贸n) siempre se considera completado para que el usuario pueda avanzar al 1.
            completionStatus[0] = true; 

            // Crear los 铆tems de navegaci贸n
            SCENARIOS.forEach((scenario, index) => {
                const li = document.createElement('li');
                li.className = "mb-2";
                const a = document.createElement('a');
                a.id = `nav-item-${index}`;
                a.href = "#";
                a.textContent = `${index}. ${scenario.title}`;
                a.className = "nav-item block p-2 rounded-lg text-gray-700 transition duration-150 cursor-pointer";
                a.onclick = (e) => {
                    e.preventDefault();
                    loadScenario(index);
                };
                li.appendChild(a);
                unitList.appendChild(li);
            });
            
            // Actualizar el estado inicial de bloqueo antes de cargar
            updateSidebarLockStatus();

            // Cargar el primer escenario al inicio
            loadScenario(0);
        }

        // Iniciar la aplicaci贸n al cargar la p谩gina
        window.onload = initApp;

    </script>
</body>
</html>